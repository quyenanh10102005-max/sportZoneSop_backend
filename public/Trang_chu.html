<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportZoneVN - Giày bóng đá chính hãng Việt Nam</title>
    <meta name="description" content="SportZoneVN - Chuyên cung cấp giày bóng đá chính hãng Nike, Adidas, Puma, Mizuno với giá tốt nhất">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="Trang_chu.css">
</head>
<body>

    <div class="welcome">
        <i class="fa-solid fa-star" style="margin-right: 8px;"></i>
        Chào mừng đến với SportZoneVN - Giày bóng đá chính hãng Việt Nam
        <i class="fa-solid fa-star" style="margin-left: 8px;"></i>
    </div>

    <header id="mainHeader">
        <div class="header-logo">
            <a href="Trang_chu.html">
                <img src="/images/Logo_.png" alt="SportZoneVN Logo">
            </a>
        </div>

        <div class="header-search">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" placeholder="Tìm kiếm sản phẩm ..." aria-label="Tìm kiếm sản phẩm">
        </div> 

        <div class="header_menu">
            <i class="fa-solid fa-user" id="userIcon" aria-label="Menu người dùng"></i>
            <span id="userName"></span>
            <ul class="header_main_menu" id="menuList">
                <li id="welcomeMessage" style="display: none; padding: 12px 20px; font-weight: 600; color: #667eea; border-bottom: 1px solid #eee;">
                    Xin chào, <span id="welcomeUserName"></span>
                </li>
                <li id="registerLi"><a href="./Dang_ky.html"><i class="fa-solid fa-user-plus" style="margin-right: 8px;"></i>Đăng ký</a></li>
                <li id="loginLi"><a href="./Dang_nhap.html"><i class="fa-solid fa-right-to-bracket" style="margin-right: 8px;"></i>Đăng nhập</a></li>
                <li id="logoutLi" style="display: none;"><a href="#"><i class="fa-solid fa-right-from-bracket" style="margin-right: 8px;"></i>Đăng xuất</a></li>
            </ul>
        </div>

        <div class="header_gio_hang">
            <a href="Gio_Hang.html" aria-label="Giỏ hàng">
                <i class="fa-solid fa-cart-shopping" data-count="0"></i>
            </a>
        </div>
    </header>


    <nav>
        <ul class="main_menu">
            <li><a href="Trang_chu.html"><i class="fa-solid fa-house" style="margin-right: 5px;"></i>Trang chủ</a></li>

            <li class="submenu">
                <a href="#"><i class="fa-solid fa-futbol" style="margin-right: 5px;"></i>Giày bóng đá</a>
                <ul class="has_submenu">
                    <li><a href="Danh_Sach_San_Pham.html">Tất cả sản phẩm</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?loai=Sân cỏ nhân tạo">Giày sân cỏ nhân tạo</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?loai=Sân cỏ tự nhiên">Giày sân cỏ tự nhiên</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?loai=Sân Futsal">Giày sân Futsal</a></li>
                </ul>
            </li>

            <li class="submenu">
                <a href="#"><i class="fa-solid fa-tag" style="margin-right: 5px;"></i>Thương hiệu</a>
                <ul class="has_submenu">
                    <li><a href="Danh_Sach_San_Pham.html?thuongHieu=Nike">Nike</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?thuongHieu=Adidas">Adidas</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?thuongHieu=Puma">Puma</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?thuongHieu=Mizuno">Mizuno</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?thuongHieu=Kamito">Kamito</a></li>
                    <li><a href="Danh_Sach_San_Pham.html?thuongHieu=Zocker">Zocker</a></li>
                </ul>
            </li>

            <li><a href="Phu_Kien.html"><i class="fa-solid fa-shirt" style="margin-right: 5px;"></i>Phụ kiện</a></li>
            <li><a href="Tin_Tuc_Giay.html"><i class="fa-solid fa-newspaper" style="margin-right: 5px;"></i>Tin tức giày</a></li>
            <li><a href="Khuyen_Mai.html"><i class="fa-solid fa-percent" style="margin-right: 5px;"></i>Khuyến mãi</a></li>
            <li><a href="Ve_chung_toi.html"><i class="fa-solid fa-circle-info" style="margin-right: 5px;"></i>Về chúng tôi</a></li>
        </ul>
    </nav>


    <main>
        <div class="carousel slide" id="productCarousel" data-bs-ride="carousel" data-bs-interval="4000">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="/images/brand_banner_1.jpg" class="d-block w-100" alt="Banner giày Nike">
                </div>
                <div class="carousel-item">
                    <img src="/images/brand_banner_2.jpg" class="d-block w-100" alt="Banner giày Adidas">
                </div>
                <div class="carousel-item">
                    <img src="/images/index_banner_6.jpg" class="d-block w-100" alt="Banner khuyến mãi">
                </div>
                <div class="carousel-item">
                    <img src="/images/index_banner_7.jpg" class="d-block w-100" alt="Banner giày mới">
                </div>
            </div>
      
            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>

            <div class="carousel-indicators">
                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
            </div>
        </div>
    </main>


    <section class="container mt-5">
        <h2 class="section-title">
            <i class="fa-solid fa-fire" style="color: #ff6b6b; margin-right: 10px;"></i>
            SẢN PHẨM MỚI NHẤT
            <i class="fa-solid fa-fire" style="color: #ff6b6b; margin-left: 10px;"></i>
        </h2>
        <div class="row" id="ds-sanpham">
            <div class="text-center" style="width: 100%; padding: 40px;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang tải...</span>
                </div>
                <p class="text-muted mt-3">Đang tải sản phẩm...</p>
            </div>
        </div>
    </section>


    <footer>
        <div class="footer-section footer-info">
            <h2>THÔNG TIN LIÊN HỆ</h2>
            <h1 style="font-size: 24px; margin: 15px 0; color: #fff; font-weight: 700;">SportZoneVN</h1>
            <p style="font-size: 15px; margin-bottom: 15px; font-weight: 500;">Giày bóng đá chính hãng Việt Nam</p>
            <p><i class="fa-solid fa-location-dot"></i> Địa chỉ: Đông Yên - Đông Sơn - Thanh Hóa</p>
            <p><i class="fa-solid fa-phone"></i> Hotline: <a href="tel:0329127111" style="color: #ecf0f1; text-decoration: none;">0329127111</a></p>
            <p><i class="fa-solid fa-envelope"></i> Email: <a href="mailto:contact@sportzonevn.com" style="color: #ecf0f1; text-decoration: none;">contact@sportzonevn.com</a></p>
        </div>

        <div class="footer-section footer-links">
            <h2>HỖ TRỢ KHÁCH HÀNG</h2>
            <ul>
                <li><a href="#"><i class="fa-solid fa-circle-question" style="margin-right: 5px;"></i>Hướng dẫn đặt hàng</a></li>
                <li><a href="#"><i class="fa-solid fa-shield-halved" style="margin-right: 5px;"></i>Chính sách bảo mật</a></li>
                <li><a href="#"><i class="fa-solid fa-rotate" style="margin-right: 5px;"></i>Chính sách đổi trả</a></li>
                <li><a href="#"><i class="fa-solid fa-comments" style="margin-right: 5px;"></i>FAQ - Câu hỏi thường gặp</a></li>
            </ul>
        </div>

        <div class="footer-section footer-social">
            <h2>KẾT NỐI VỚI CHÚNG TÔI</h2>
            <div class="lien_ket">
                <a href="https://www.facebook.com/thien.uc.609096" target="_blank" aria-label="Facebook">
                    <i class="fa-brands fa-facebook-f"></i>
                </a>
                <a href="https://www.instagram.com/qanh1010/" target="_blank" aria-label="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="https://www.youtube.com/@quyenanh8600" target="_blank" aria-label="YouTube">
                    <i class="fa-brands fa-youtube"></i>
                </a>
            </div>
            <div style="margin-top: 25px;">
                <p style="font-size: 14px; margin-bottom: 10px;">Phương thức thanh toán:</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <i class="fa-brands fa-cc-visa" style="font-size: 32px; color: #ecf0f1;"></i>
                    <i class="fa-brands fa-cc-mastercard" style="font-size: 32px; color: #ecf0f1;"></i>
                    <i class="fa-solid fa-money-bill-wave" style="font-size: 32px; color: #ecf0f1;"></i>
                </div>
            </div>
        </div>
    </footer>

    <div class="gb">
        <i class="fa-regular fa-copyright" style="margin-right: 5px;"></i>
        2025 SportZoneVN - Giày bóng đá chính hãng Việt Nam. All Rights Reserved.
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        //  XỬ LÝ ĐĂNG NHẬP/ĐĂNG XUẤT 
        const user = localStorage.getItem("user");
        const userNameSpan = document.getElementById("userName");
        const welcomeMessageLi = document.getElementById("welcomeMessage");
        const welcomeUserNameSpan = document.getElementById("welcomeUserName");
        const registerLi = document.getElementById("registerLi");
        const loginLi = document.getElementById("loginLi");
        const logoutLi = document.getElementById("logoutLi");

        if (user) {
            const userData = JSON.parse(user);
            const displayUsername = userData.TenDangNhap.length > 15 
                ? userData.TenDangNhap.substring(0, 15) + '...' 
                : userData.TenDangNhap;

            welcomeUserNameSpan.textContent = displayUsername;
            welcomeMessageLi.style.display = "block";
            registerLi.style.display = "none";
            loginLi.style.display = "none";
            logoutLi.style.display = "block";
        } else {
            userNameSpan.textContent = "";
            welcomeMessageLi.style.display = "none";
            registerLi.style.display = "block";
            loginLi.style.display = "block";
            logoutLi.style.display = "none";
        }

        // Xử lý đăng xuất
        logoutLi.querySelector('a').addEventListener('click', function(e) {
            e.preventDefault();
            if(confirm('Bạn có chắc muốn đăng xuất?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = "Dang_nhap.html";
            }
        });

        const header = document.getElementById('mainHeader');
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                header.classList.add("header-scrolled");
            } else {
                header.classList.remove("header-scrolled");
            }
        });

        //  TÌM KIẾM 
        const searchInput = document.querySelector('.header-search input');
        const searchIcon = document.querySelector('.header-search i');

        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        searchIcon.addEventListener('click', performSearch);

        function performSearch() {
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = `Danh_Sach_San_Pham.html?q=${encodeURIComponent(query)}`;
            }
        }

        // LẤY DANH SÁCH SẢN PHẨM 
        fetch('/api/sanpham')
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('ds-sanpham');
                const validProducts = data.filter(sp => sp.ten && sp.gia);

                if (validProducts.length === 0) {
                    container.innerHTML = `<p class="text-center text-muted">Chưa có sản phẩm nào để hiển thị.</p>`;
                    return;
                }

                container.innerHTML = validProducts.map((sp, index) => {
                    const brandName = detectBrand(sp.ten);
                    
                    return `
                        <div class="col-6 col-sm-6 col-md-4 col-lg-3 mb-4">
                            <div class="card h-100 product-card" onclick="window.location.href='San_Pham.html?id=${sp._id}'" style="cursor:pointer;">
                                <div class="new-badge">NEW</div>
                                <img src="${sp.hinhAnh || '/images/default-shoe.jpg'}" 
                                     class="card-img-top" 
                                     alt="${sp.ten}"
                                     loading="lazy">
                                <div class="card-body text-center">
                                    <p class="brand-badge">${brandName || 'Khác'}</p>
                                    <h6 class="card-title">${sp.ten}</h6>
                                    <p class="product-price">${Number(sp.gia).toLocaleString()}₫</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            })
            .catch(err => {
                console.error('Lỗi khi tải sản phẩm:', err);
                document.getElementById('ds-sanpham').innerHTML =
                    `<p class="text-center text-danger"><i class="fa-solid fa-triangle-exclamation"></i> Không thể tải danh sách sản phẩm.</p>`;
            });

        // Hàm nhận diện thương hiệu
        function detectBrand(productName) {
            const brands = ['Nike', 'Adidas', 'Puma', 'Mizuno', 'Kamito', 'Zocker'];
            const nameLower = productName.toLowerCase();
            
            for (const brand of brands) {
                if (nameLower.includes(brand.toLowerCase())) {
                    return brand;
                }
            }
            return null;
        }

        //CẬP NHẬT GIỎ HÀNG 
        async function updateCartCount() {
            const user = JSON.parse(localStorage.getItem('user'));
            const cartIcon = document.querySelector('.header_gio_hang i');

            if (!user || !user.MaTK) {
                if(cartIcon) cartIcon.setAttribute('data-count', 0);
                return;
            }

            try {
                const res = await fetch(`/api/giohang/${user.MaTK}`);
                if (!res.ok) throw new Error('Không thể lấy giỏ hàng');
                
                const cart = await res.json();
                const count = cart.length || 0;

                if (cartIcon) {
                    cartIcon.setAttribute('data-count', count);
                }
            } catch (err) {
                console.error('Lỗi cập nhật giỏ hàng:', err);
                if(cartIcon) cartIcon.setAttribute('data-count', 0);
            }
        }

        updateCartCount();
    </script>
</body>
</html>